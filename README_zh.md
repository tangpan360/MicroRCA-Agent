# MicroRCA-Agentï¼šåŸºäºå¤§æ¨¡å‹æ™ºèƒ½ä½“çš„å¾®æœåŠ¡æ ¹å› å®šä½æ–¹æ³•

[English](README.md) | ä¸­æ–‡

## 2025 å›½é™… AIOps æŒ‘æˆ˜èµ›ï¼ˆå†³èµ› Top5ï¼Œ48.52åˆ†ï¼‰
## é¡¹ç›®æ¦‚è¿°

æœ¬é¡¹ç›®æ˜¯ä¸€ä¸ªåŸºäºå¤šæ¨¡æ€æ•°æ®åˆ†æçš„æ™ºèƒ½è¿ç»´è§£å†³æ–¹æ¡ˆï¼Œèƒ½å¤Ÿå¤„ç†æ—¥å¿—(Log)ã€é“¾è·¯è¿½è¸ª(Trace)å’ŒæŒ‡æ ‡(Metric)æ•°æ®ï¼Œé€šè¿‡å¤§è¯­è¨€æ¨¡å‹è¿›è¡Œæ•…éšœåˆ†æå’Œæ ¹å› å®šä½ã€‚é‡‡ç”¨æ¨¡å—åŒ–æ¶æ„è®¾è®¡ï¼Œæ•´ä½“ç³»ç»Ÿåˆ†ä¸ºäº”ä¸ªæ ¸å¿ƒæ¨¡å—ï¼šæ•°æ®é¢„å¤„ç†æ¨¡å—ã€æ—¥å¿—æ•…éšœæŠ½å–æ¨¡å—ã€è¿½è¸ªæ•…éšœæ£€æµ‹æ¨¡å—ã€æŒ‡æ ‡æ•…éšœæ€»ç»“æ¨¡å—å’Œå¤šæ¨¡æ€æ ¹å› åˆ†ææ¨¡å—ã€‚å„æ¨¡å—é—´é‡‡ç”¨æ¾è€¦åˆè®¾è®¡ï¼Œé€šè¿‡å‡½æ•°å°è£…è¿›è¡Œæ•°æ®äº¤äº’ï¼Œæ—¢ä¿è¯äº†ç³»ç»Ÿçš„æ•´ä½“æ€§ï¼Œåˆç¡®ä¿äº†å„æ¨¡å—çš„ç‹¬ç«‹æ€§å’Œå¯æ‰©å±•æ€§ã€‚
è¾“å‡ºåŒ…å«componentã€reasonã€reasoning_traceçš„ç»“æ„åŒ–æ ¹å› åˆ†æç»“æœï¼Œå®ç°ä»ç°è±¡è§‚å¯Ÿåˆ°æ ¹å› æ¨ç†çš„å®Œæ•´é—­ç¯ã€‚

![é¡¹ç›®æ¶æ„å›¾](imgs/overview_zh.png)




## æ–‡ä»¶ç»“æ„è¯´æ˜

```
â”œâ”€â”€ README.md  # è‹±æ–‡é¡¹ç›®æ–‡æ¡£
â”œâ”€â”€ README_zh.md  # ä¸­æ–‡é¡¹ç›®æ–‡æ¡£
â”œâ”€â”€ domain.conf  # å¤–ç½‘åŸŸåé…ç½®
â”œâ”€â”€ src/  # æºä»£ç ç›®å½•
â”‚   â”œâ”€â”€ agent/  # æ™ºèƒ½ä»£ç†æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ __init__.py  # åŒ…åˆå§‹åŒ–æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ agents.py  # ä»£ç†å®ç°
â”‚   â”‚   â”œâ”€â”€ llm_config.py  # LLMé…ç½®ï¼Œåœ¨è¿™é‡Œé…ç½®agentä½¿ç”¨çš„æ¨¡å‹åˆ—è¡¨
â”‚   â”‚   â””â”€â”€ prompts.py  # æç¤ºè¯æ¨¡æ¿
â”‚   â”œâ”€â”€ utils/  # å·¥å…·æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ drain/  # Drainæ—¥å¿—æ¨¡æ¿æå–
â”‚   â”‚   â”‚   â”œâ”€â”€ drain_template_extractor.py  # Drainæ¨¡æ¿æå–å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ drain3.ini  # Drain3é…ç½®æ–‡ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ error_log-drain.pkl  # é¢„è®­ç»ƒå¥½çš„æ¨¡æ¿æå–æ¨¡å‹
â”‚   â”‚   â”‚   â””â”€â”€ error_log-template.csv  # æ—¥å¿—æ¨¡æ¿æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ __init__.py  # åŒ…åˆå§‹åŒ–æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ file_utils.py  # æ–‡ä»¶å¤„ç†å·¥å…·
â”‚   â”‚   â”œâ”€â”€ io_util.py  # IOå·¥å…·
â”‚   â”‚   â”œâ”€â”€ llm_record_utils.py  # LLMè®°å½•å·¥å…·
â”‚   â”‚   â”œâ”€â”€ log_template_extractor.py  # æ—¥å¿—æ¨¡æ¿æå–å™¨ï¼ˆè®­ç»ƒerrot_log-drain.pklï¼‰
â”‚   â”‚   â”œâ”€â”€ log_template_extractor_with_examples.py  # å¸¦ç¤ºä¾‹çš„æ—¥å¿—æ¨¡æ¿æå–å™¨ï¼ˆç”¨äºè§‚å¯Ÿè®­ç»ƒçš„drainæå–æ•ˆæœï¼‰
â”‚   â”‚   â”œâ”€â”€ log_utils.py  # æ—¥å¿—å¤„ç†å·¥å…·ï¼ˆç”¨äºè°ƒç”¨æ—¥å¿—ä¿¡æ¯ä¾›å¤§æ¨¡å‹ä½¿ç”¨ï¼‰
â”‚   â”‚   â”œâ”€â”€ metric_utils.py  # æŒ‡æ ‡å¤„ç†å·¥å…·ï¼ˆç”¨äºè°ƒç”¨æŒ‡æ ‡ä¿¡æ¯ä¾›å¤§æ¨¡å‹ä½¿ç”¨ï¼‰
â”‚   â”‚   â””â”€â”€ trace_utils.py  # é“¾è·¯è¿½è¸ªå¤„ç†å·¥å…·ï¼ˆç”¨äºè°ƒç”¨é“¾è·¯è¿½è¸ªä¿¡æ¯ä¾›å¤§æ¨¡å‹ä½¿ç”¨ï¼‰
â”‚   â”œâ”€â”€ models  # æ¨¡å‹ï¼ˆtraceå¼‚å¸¸æ£€æµ‹æ¨¡å‹ï¼‰
â”‚   â”œâ”€â”€ scripts/  # æ•°æ®é¢„å¤„ç†è„šæœ¬ï¼ŒåŒ…æ‹¬ç»Ÿä¸€logã€traceã€metricçš„æ—¶é—´æˆ³ç­‰æ“ä½œ
â”‚   â”‚   â”œâ”€â”€ merge_phaseone_phasetwo_input_json.py  # å°† phaseone å’Œ phasetwo çš„ input.jsonl åˆå¹¶æˆä¸€ä¸ª input.jsonl çš„è„šæœ¬
â”‚   â”‚   â”œâ”€â”€ raw_log_processor.py  # åŸå§‹æ—¥å¿—å¤„ç†
â”‚   â”‚   â”œâ”€â”€ raw_metric_processor.py  # åŸå§‹æŒ‡æ ‡å¤„ç†
â”‚   â”‚   â””â”€â”€ raw_trace_processor.py  # åŸå§‹é“¾è·¯è¿½è¸ªå¤„ç†
â”‚   â”œâ”€â”€ models/  # æ¨¡å‹æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ trace_detectors.pkl  # traceå¼‚å¸¸æ£€æµ‹æ£€æµ‹å™¨æ¨¡å‹
â”‚   â”‚   â””â”€â”€ trace_detectors_normal_stats.pkl  # traceæ­£å¸¸çŠ¶æ€ç»Ÿè®¡
â”‚   â”œâ”€â”€ input/  # è¾“å…¥æ•°æ®å¤„ç†
â”‚   â”‚   â”œâ”€â”€ extract_input_timestamp.py  # æ—¶é—´æˆ³æå–
â”‚   â”‚   â””â”€â”€ input_timestamp.csv  # æå–äº†è¾“å…¥çš„æ—¶é—´æˆ³ç­‰ä¿¡æ¯ï¼Œä¾¿äºåæœŸè°ƒç”¨
â”‚   â”œâ”€â”€ submission/  # æäº¤ç»“æœ
â”‚   â”‚   â”œâ”€â”€ result.jsonl  # ç»“æœæ–‡ä»¶
â”‚   â”‚   â””â”€â”€ submit.py  # æäº¤è„šæœ¬
â”‚   â”œâ”€â”€ main_multiprocessing.py  # ä¸»ç¨‹åºå…¥å£
â”‚   â”œâ”€â”€ preprocessing.sh  # æ•°æ®é¢„å¤„ç†è„šæœ¬ï¼ˆå¦‚æœéœ€è¦ä¸‹è½½å’Œé¢„å¤„ç†ï¼‰
â”‚   â””â”€â”€ requirements.txt  # Pythonä¾èµ–
â”œâ”€â”€ data/  # ä¸‹è½½å¹¶ä¸”ä¸å¤„ç†å¥½çš„æ•°æ®æ–‡ä»¶ç›®å½•
â”œâ”€â”€ Dockerfile  # Dockeré•œåƒæ„å»ºæ–‡ä»¶
â””â”€â”€ run.sh  # å¯åŠ¨è„šæœ¬
```

## æŠ€æœ¯æ–¹æ¡ˆè¯¦è¿°

### 1. æ•°æ®é¢„å¤„ç†

#### 1.1 è¾“å…¥æ•°æ®è§£æè®¾è®¡
- **æ­£åˆ™è¡¨è¾¾å¼æå–ç­–ç•¥**: å¯¹åŸå§‹æ•…éšœæè¿°æ–‡ä»¶è¿›è¡Œç»“æ„åŒ–å¤„ç†
  - æ¥æ”¶JSONæ ¼å¼è¾“å…¥æ•°æ®ï¼ŒåŒ…å«æ•…éšœæè¿°ï¼ˆAnomaly Descriptionï¼‰å’Œå”¯ä¸€æ ‡è¯†ç¬¦ï¼ˆuuidï¼‰
  - æ—¶é—´æˆ³æå–æœºåˆ¶ï¼šé‡‡ç”¨ISO 8601æ—¶é—´æ ¼å¼æ ‡å‡†ï¼Œé€šè¿‡æ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼è¯†åˆ«æ•…éšœèµ·æ­¢æ—¶é—´
  - æ—¶é—´ç´¢å¼•ç”Ÿæˆï¼šç”Ÿæˆ"å¹´-æœˆ-æ—¥_æ—¶"æ ¼å¼çš„æ—¶é—´æ ‡è¯†ï¼Œç”¨äºå¿«é€Ÿå®šä½æ•°æ®æ–‡ä»¶
  - çº³ç§’çº§æ—¶é—´æˆ³è½¬æ¢ï¼šå°†æ•…éšœæ—¶é—´è½¬æ¢ä¸º19ä½çº³ç§’çº§æ—¶é—´æˆ³

#### 1.2 å¤šæ¨¡æ€æ•°æ®æ—¶é—´æˆ³ç»Ÿä¸€
- **å·®å¼‚åŒ–æ—¶é—´æˆ³ç»Ÿä¸€å¤„ç†ç­–ç•¥**: é’ˆå¯¹logã€traceå’Œmetricä¸‰ç§æ•°æ®çš„ä¸åŒæ ¼å¼ç‰¹ç‚¹
  - Logæ•°æ®ï¼šé‡‡ç”¨ISO 8601æ ¼å¼çš„@timestampå­—æ®µï¼Œè½¬æ¢ä¸ºç»Ÿä¸€çš„19ä½çº³ç§’çº§æ—¶é—´æˆ³
  - Traceæ•°æ®ï¼šstartTimeå­—æ®µå­˜å‚¨å¾®ç§’çº§æ—¶é—´æˆ³ï¼Œé€šè¿‡ç²¾åº¦è½¬æ¢æ‰©å±•ä¸ºçº³ç§’çº§ï¼ˆä¹˜ä»¥1000å€æ•°ï¼‰
  - Metricæ•°æ®ï¼štimeå­—æ®µéµå¾ªISO 8601æ ¼å¼ï¼Œé‡‡ç”¨é€’å½’æœç´¢ç­–ç•¥ç¡®ä¿å®Œæ•´è¦†ç›–åˆ†æ•£å­˜å‚¨çš„æŒ‡æ ‡æ–‡ä»¶
- **æ—¶åºä¸€è‡´æ€§ä¿éšœ**: å¤„ç†å®ŒæˆåæŒ‰æ—¶é—´æˆ³å‡åºæ’åˆ—ï¼Œç¡®ä¿è·¨æ¨¡æ€æ—¶é—´åŸºå‡†çš„æ ‡å‡†åŒ–

### 2. å¤šæ¨¡æ€æ•°æ®å¤„ç†

#### 2.1 æ—¥å¿—æ•°æ®å¤„ç†
- **Drain3 ç®—æ³•**: åŸºäºåŒ…å«errorçš„æ—¥å¿—è®­ç»ƒDrain3æ¨¡å‹ï¼Œå¹¶ä½¿ç”¨é¢„è®­ç»ƒçš„Drain3æ¨¡å‹(`error_log-drain.pkl`)è¿›è¡Œæ—¥å¿—æ¨¡æ¿æå–
  - è‡ªåŠ¨è¯†åˆ«æ—¥å¿—æ¨¡å¼ï¼Œå°†ç›¸ä¼¼çš„æ—¥å¿—å½’ç±»åˆ°åŒä¸€æ¨¡æ¿
  - å¤§å¹…å‡å°‘æ—¥å¿—æ•°æ®é‡ï¼Œæå–å…³é”®é”™è¯¯ä¿¡æ¯
  - ç”¨äºæ—¥å¿—å»é‡å’Œé¢‘æ¬¡ç»Ÿè®¡
- **å¤šå±‚çº§æ•°æ®ç­›é€‰å¤„ç†æµç¨‹**:
  - æ–‡ä»¶å®šä½ï¼šæ ¹æ®æ—¶é—´ä¿¡æ¯ç²¾å‡†åŒ¹é…æ•…éšœæ—¶é—´çª—å£å†…çš„æ—¥å¿—æ–‡ä»¶
  - æ—¶é—´çª—è¿‡æ»¤ï¼šåŸºäºçº³ç§’çº§æ—¶é—´æˆ³è¿›è¡Œä¸¥æ ¼çš„æ—¶é—´è¾¹ç•Œç­›é€‰
  - Errorå…³é”®è¯è¿‡æ»¤ï¼šæå–åŒ…å«errorä¿¡æ¯çš„æ—¥å¿—æ¡ç›®ï¼Œè¿‡æ»¤æ­£å¸¸ä¸šåŠ¡æ—¥å¿—
  - æ ¸å¿ƒå­—æ®µæå–ï¼šæå–æ—¶é—´ã€å®¹å™¨ã€èŠ‚ç‚¹å’Œé”™è¯¯æ¶ˆæ¯ç­‰å…³é”®ä¿¡æ¯
  - æ•…éšœæ¨¡æ¿åŒ¹é…ï¼šåˆ©ç”¨é¢„è®­ç»ƒDrainæ¨¡å‹è¿›è¡Œæ¨¡æ¿åŒ¹é…ä¸æ ‡å‡†åŒ–
  - æ ·æœ¬å»é‡ç»Ÿè®¡ï¼šå¯¹é‡å¤æ—¥å¿—å»é‡å¹¶ç»Ÿè®¡é¢‘æ¬¡ï¼Œè¯„ä¼°æ•…éšœä¸¥é‡ç¨‹åº¦
  - æœåŠ¡ä¿¡æ¯æå–ï¼šå°†Podä¿¡æ¯æ˜ å°„ä¸ºserviceï¼Œé‡æ„ä¸ºæ ‡å‡†åŒ–æ ¼å¼

#### 2.2 é“¾è·¯è¿½è¸ª (Trace) å¤„ç†
- **åŒé‡å¼‚å¸¸æ£€æµ‹ç­–ç•¥**: ç»“åˆæ€§èƒ½ç»´åº¦å’ŒçŠ¶æ€ç»´åº¦è¯†åˆ«å¾®æœåŠ¡è°ƒç”¨é“¾ä¸­çš„å¼‚å¸¸æ¨¡å¼
  - Durationå¼‚å¸¸æ£€æµ‹ï¼šåŸºäºIsolationForestç®—æ³•æ£€æµ‹è°ƒç”¨æ—¶å»¶å¼‚å¸¸
  - StatusçŠ¶æ€æ£€æµ‹ï¼šç›´æ¥æ£€æŸ¥status.codeå’Œstatus.messageè¯†åˆ«é”™è¯¯çŠ¶æ€
- **IsolationForestæ€§èƒ½å¼‚å¸¸æ£€æµ‹**:
  - é¢„è®­ç»ƒæ¨¡å‹å­˜å‚¨ï¼š`trace_detectors.pkl` å’Œ `trace_detectors_normal_stats.pkl`
  - åŸºäºæ•…éšœæ¢å¤å40åˆ†é’Ÿæ­£å¸¸æœŸæ•°æ®è®­ç»ƒï¼ŒæŒ‰"parent_pod-child_pod-æ“ä½œåç§°"åˆ†ç»„è®­ç»ƒ
  - é‡‡ç”¨30ç§’æ»‘åŠ¨çª—å£å¤„ç†durationç‰¹å¾ï¼Œè®¾ç½®1%å¼‚å¸¸æ±¡æŸ“ç‡
- **çŠ¶æ€ç ç›´æ¥æ£€æŸ¥æœºåˆ¶**:
  - è§£ætrace tagsä¸­çš„status.codeå’Œstatus.messageå­—æ®µ
  - é€šè¿‡æ¡ä»¶è¿‡æ»¤ï¼ˆstatus.codeâ‰ 0ï¼‰ç›´æ¥è¯†åˆ«å¼‚å¸¸çŠ¶æ€è°ƒç”¨
  - æä¾›ç¡®å®šæ€§çš„é”™è¯¯çŠ¶æ€è¯†åˆ«å’Œè¯¦ç»†é”™è¯¯ä¿¡æ¯
- **è°ƒç”¨å…³ç³»æ˜ å°„**: æå–pod_nameã€service_nameã€node_nameï¼Œå»ºç«‹å®Œæ•´çš„è°ƒç”¨é“¾çˆ¶å­å…³ç³»
- **ç»“æ„åŒ–è¾“å‡º**: åˆ†åˆ«è¾“å‡ºå‰20ä¸ªdurationå¼‚å¸¸å’Œstatuså¼‚å¸¸ç»„åˆï¼ŒåŒ…å«èŠ‚ç‚¹ã€æœåŠ¡ã€å®¹å™¨ã€æ“ä½œç­‰ç»´åº¦ä¿¡æ¯

#### 2.3 æŒ‡æ ‡æ•°æ® (Metric) å¤„ç†
- **åŒå±‚çº§å¤§æ¨¡å‹ç°è±¡æ€»ç»“ç­–ç•¥**: åŸºäºå¤§è¯­è¨€æ¨¡å‹çš„æ™ºèƒ½ç°è±¡è¯†åˆ«ä¸å½’çº³åˆ†æ
  - ç¬¬ä¸€å±‚ï¼šåº”ç”¨æ€§èƒ½ç›‘æ§ç°è±¡è¯†åˆ«ä¸æ€»ç»“ï¼ˆAPMæŒ‡æ ‡+TiDBæ•°æ®åº“ç»„ä»¶æŒ‡æ ‡ï¼‰
  - ç¬¬äºŒå±‚ï¼šåŸºç¡€è®¾æ–½æœºå™¨æ€§èƒ½æŒ‡æ ‡ç»¼åˆç°è±¡æ€»ç»“ä¸å…³è”åˆ†æ
- **å¤šå±‚çº§ç›‘æ§æŒ‡æ ‡ä½“ç³»**:
  - APMä¸šåŠ¡ç›‘æ§ï¼š7ä¸ªæ ¸å¿ƒæŒ‡æ ‡ï¼ˆerror_ratioã€requestã€responseã€rrtã€timeoutç­‰ï¼‰
  - Podå®¹å™¨å±‚ï¼š9ä¸ªåŸºç¡€è®¾æ–½æŒ‡æ ‡ï¼ˆcpu_usageã€memoryã€networkã€filesystemç­‰ï¼‰
  - NodeèŠ‚ç‚¹å±‚ï¼š16ä¸ªåŸºç¡€è®¾æ–½æŒ‡æ ‡ï¼ˆcpuã€memoryã€diskã€networkã€TCPè¿æ¥ç­‰ï¼‰
  - TiDBæ•°æ®åº“ï¼š3ä¸ªç»„ä»¶å…±20ä¸ªä¸“é¡¹æŒ‡æ ‡ï¼ˆqueryã€durationã€connectionã€raftç­‰ï¼‰
- **æ™ºèƒ½æ•°æ®ç­›é€‰ä¸å¤„ç†**:
  - æ­£å¸¸æ—¶é—´æ®µå®šä¹‰ï¼šæ•…éšœå‰åç›¸é‚»æ—¶é—´çª—å£ï¼Œå‰ä¸€æ•…éšœç»“æŸå10åˆ†é’Ÿè‡³å½“å‰æ•…éšœå¼€å§‹å‰ï¼Œä»¥åŠå½“å‰æ•…éšœç»“æŸå10åˆ†é’Ÿè‡³ä¸‹ä¸€æ•…éšœå¼€å§‹å‰ï¼Œé¿å…æ•…éšœ"ä½™æ³¢"å½±å“
  - ç»Ÿè®¡å¯¹ç§°æ¯”ç‡ç­›é€‰ï¼šè‡ªåŠ¨è¿‡æ»¤å˜åŒ–å¹…åº¦å°äº5%çš„ç¨³å®šæŒ‡æ ‡
  - å¼‚å¸¸å€¼ç§»é™¤ï¼šç§»é™¤æœ€å¤§æœ€å°å„2ä¸ªæå€¼ï¼Œæ„å»ºç¨³å®šç»Ÿè®¡åŸºçº¿
  - Pod-Serviceç»Ÿä¸€åˆ†æï¼šé€šè¿‡Podåç§°è‡ªåŠ¨æå–Serviceæ ‡è¯†
- **llmæ€»ç»“è¾“å‡ºå†…å®¹**:
  - åº”ç”¨æ€§èƒ½å¼‚å¸¸ç°è±¡ï¼šæœåŠ¡çº§åˆ«æ•´ä½“è¶‹åŠ¿å’ŒPodçº§åˆ«ä¸ªä½“å·®å¼‚
  - åŸºç¡€è®¾æ–½æœºå™¨æ€§èƒ½å¼‚å¸¸ç°è±¡ï¼šè·¨å®¹å™¨å’ŒèŠ‚ç‚¹çš„èµ„æºçŠ¶æ€å˜åŒ–
  - è·¨å±‚çº§å…³è”ç°è±¡æ¨¡å¼ï¼šå¼‚å¸¸åˆ†å¸ƒç‰¹å¾å’Œä¼ æ’­è·¯å¾„è¯†åˆ«

### 3. é«˜æ€§èƒ½å¤„ç†

#### 3.1 å¹¶è¡Œè®¡ç®—
- **å¤šè¿›ç¨‹æ¶æ„**: åŸºäºCPUæ ¸å¿ƒæ•°åŠ¨æ€è°ƒæ•´è¿›ç¨‹æ± å¤§å°(é»˜è®¤0.5å€æ ¸å¿ƒæ•°)
- **ä»»åŠ¡åˆ†ç‰‡**: å°†æ•…éšœæ—¶é—´æ®µåˆ†ç‰‡å¹¶è¡Œå¤„ç†

#### 3.2 å®¹é”™æœºåˆ¶
- **é‡è¯•ç­–ç•¥**: æ¯ä¸ªæ—¶é—´æ®µæœ€å¤šé‡è¯•3æ¬¡å¤„ç†
- **å¼‚å¸¸éš”ç¦»**: å•ä¸ªæ—¶é—´æ®µå¤„ç†å¤±è´¥ä¸å½±å“æ•´ä½“æµç¨‹
- **æ•°æ®ç¼ºå¤±å®¹å¿**: æŸäº›ç±»å‹çš„æ•°æ®ï¼ˆå¦‚logã€traceæˆ–metricï¼‰ç¼ºå¤±æ—¶ï¼Œç³»ç»Ÿä»å¯åˆ©ç”¨ç°æœ‰æ•°æ®ç»§ç»­è¿›è¡Œåˆ†æ

### 4. æ ¹å› ç»“æœè¾“å‡ºç¤ºä¾‹ï¼ˆå­—æ®µç»„åˆè§†ä»»åŠ¡è€Œå®šï¼‰:
```bash
{
  "uuid": "33c11d00-2",
  "component": "checkoutservice",
  "reason": "disk IO overload",
  "reasoning_trace": [
    {
      "step": 1,
      "action": "LoadMetrics(checkoutservice)",
      "observation": "disk_read_latency spike"
    },
    {
      "step": 2,
      "action": "TraceAnalysis('frontend -> checkoutservice')",
      "observation": "checkoutservice self-loop spans"
    },
    {
      "step": 3,
      "action": "LogSearch(checkoutservice)",
      "observation": "IOError in 3 logs"
    }
  ]
}
   ```
## å‰ç½®ä¾èµ–å®‰è£…

### Git LFS å®‰è£…ï¼ˆå¿…éœ€ï¼‰

ç”±äºé¡¹ç›®æ•°æ®é›†å’Œæƒé‡æ–‡ä»¶ä½¿ç”¨Git LFSè¿›è¡Œç®¡ç†ï¼Œè¿è¡Œå‰éœ€è¦å…ˆå®‰è£…å¹¶é…ç½®Git LFSã€‚

#### ğŸ§ åœ¨ Ubuntu ä¸Šå®‰è£… Git LFS

**âœ… æ­¥éª¤ 1ï¼šæ·»åŠ  Git LFS çš„ä»“åº“**
```bash
curl -s https://packagecloud.io/install/repositories/github/git-lfs/script.deb.sh | sudo bash
```
è¿™ä¸ªå‘½ä»¤ä¼šè‡ªåŠ¨æ·»åŠ  Git LFS çš„å®˜æ–¹ APT æºã€‚

**âœ… æ­¥éª¤ 2ï¼šå®‰è£… Git LFS**
```bash
sudo apt-get install git-lfs
```

**âœ… æ­¥éª¤ 3ï¼šåˆå§‹åŒ– Git LFS**
å®‰è£…å®Œæˆåï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥å¯ç”¨ Git LFSï¼š
```bash
git lfs install
```
è¿™å°†é…ç½® Git ä»¥æ”¯æŒ LFS åŠŸèƒ½ã€‚

**ğŸ” éªŒè¯æ˜¯å¦æˆåŠŸå®‰è£… Git LFS**
é€šè¿‡ä»¥ä¸‹å‘½ä»¤éªŒè¯æ˜¯å¦æ­£ç¡®å®‰è£…å¹¶å¯ç”¨äº† Git LFSï¼š
```bash
git lfs version
```
è¾“å‡ºç¤ºä¾‹ï¼š
```
git-lfs/3.6.1 (GitHub; linux amd64; go 1.23.3)
```

### Python ä¾èµ–å®‰è£…ï¼ˆå¿…éœ€ï¼‰

é¡¹ç›®çš„æ•°æ®é¢„å¤„ç†è„šæœ¬ï¼ˆ`src/preprocessing.sh`ä¸­è°ƒç”¨çš„Pythonè„šæœ¬ï¼‰éœ€è¦ä½¿ç”¨`src/requirements.txt`ä¸­æŒ‡å®šçš„ä¾èµ–åŒ…ã€‚

**âœ… åˆ›å»ºcondaç¯å¢ƒå¹¶å®‰è£…ä¾èµ–**

```bash
# åˆ›å»ºPython 3.10ç¯å¢ƒ
conda create -n microrca python=3.10

# æ¿€æ´»ç¯å¢ƒ
conda activate microrca

# è¿›å…¥é¡¹ç›®ç›®å½•å¹¶å®‰è£…ä¾èµ–
cd MicroRCA-Agent
pip install -r src/requirements.txt
```

**âš ï¸ æ³¨æ„äº‹é¡¹**
- é¢„å¤„ç†é˜¶æ®µå¿…é¡»å…ˆå®‰è£…è¿™äº›ä¾èµ–ï¼Œå¦åˆ™ä¼šå¯¼è‡´æ•°æ®å¤„ç†è„šæœ¬æ‰§è¡Œå¤±è´¥
- å…¶ä»–å®‰è£…ç¯å¢ƒä¾èµ–çš„æ–¹å¼ï¼ˆå¦‚virtualenvã€pipenvç­‰ï¼‰å¯ä»¥æ ¹æ®ä¸ªäººä¹ æƒ¯è‡ªè¡Œé…ç½®


## é…ç½®è¯´æ˜

### ç¯å¢ƒå˜é‡

è¯·æ·»åŠ è‡ªå·±çš„ deepseek å®˜æ–¹APIå¯†é’¥ï¼Œé€šè¿‡ `src/.env` æ–‡ä»¶é…ç½®ä»¥ä¸‹ç¯å¢ƒå˜é‡ï¼š

- `KEJIYUN_API_KEY`: LLM APIå¯†é’¥
- `KEJIYUN_API_BASE`: LLM APIåŸºç¡€åœ°å€

### æ¨¡å‹é…ç½®

éœ€è¦åœ¨ `src/agent/llm_config.py` ä¸­è®¾ç½®è¦ä½¿ç”¨çš„æ¨¡å‹ã€‚é»˜è®¤å¯ç”¨ `deepseek-chat` æ¨¡å‹ï¼Œå¦‚éœ€ä½¿ç”¨å…¶ä»–æ¨¡å‹ï¼Œè¯·è‡ªè¡Œæ·»åŠ ï¼š


## è¿è¡Œæ–¹å¼

### å¿«é€Ÿå¯åŠ¨

**âš ï¸ é‡è¦æé†’ï¼šè¿è¡Œå‰è¯·ç¡®ä¿å·²å®Œæˆä¸Šè¿°é…ç½®ï¼**

```bash
bash run.sh
```

## è¯„æµ‹æäº¤ä¸ç»“æœæŸ¥è¯¢

### ğŸ† è¯„æµ‹å¹³å°
æœ¬é¡¹ç›®å‚ä¸çš„æ˜¯**CCF AIOps 2025 æŒ‘æˆ˜èµ›**ä¸­çš„"åŸºäºå¤§æ¨¡å‹æ™ºèƒ½ä½“çš„å¾®æœåŠ¡æ ¹å› å®šä½"èµ›é“ã€‚

**å®˜æ–¹è¯„æµ‹å¹³å°**ï¼š[https://challenge.aiops.cn/home/competition/1963605668447416345](https://challenge.aiops.cn/home/competition/1963605668447416345)

### ğŸ“‹ è¯„æµ‹æµç¨‹

#### **æ­¥éª¤ 1ï¼šå¹³å°æ³¨å†Œä¸ç™»å½•**
1. è®¿é—®[è¯„æµ‹å¹³å°](https://challenge.aiops.cn/home/competition/1963605668447416345)å¹¶å®Œæˆè´¦å·æ³¨å†Œ
2. ç™»å½•åè¿›å…¥"åŸºäºå¤§æ¨¡å‹æ™ºèƒ½ä½“çš„å¾®æœåŠ¡æ ¹å› å®šä½"æ¯”èµ›é¡µé¢

#### **æ­¥éª¤ 2ï¼šè·å–å›¢é˜Ÿæ ‡è¯†**
1. ç™»å½•æˆåŠŸåï¼Œç‚¹å‡»é¡µé¢é¡¶éƒ¨çš„"**å›¢é˜Ÿ**"é€‰é¡¹å¡
2. åœ¨å›¢é˜Ÿä¿¡æ¯é¡µé¢æ‰¾åˆ°å¹¶å¤åˆ¶æ‚¨çš„"**å›¢é˜ŸID**"

#### **æ­¥éª¤ 3ï¼šé…ç½®æäº¤å‡­è¯**
ç¼–è¾‘ `submission/submit.py` æ–‡ä»¶ï¼Œæ‰¾åˆ° `TICKET` å˜é‡å¹¶æ›¿æ¢ä¸ºæ‚¨çš„å›¢é˜ŸIDï¼š
```python
TICKET = "your_team_id_here"  # è¯·å°†æ­¤å¤„æ›¿æ¢ä¸ºæ‚¨çš„å®é™…å›¢é˜ŸID
```

#### **æ­¥éª¤ 4ï¼šè¿è¡Œç®—æ³•ç”Ÿæˆé¢„æµ‹ç»“æœ**
åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œä¸»ç¨‹åºï¼š
```bash
bash run.sh
```
> â±ï¸ ç¨‹åºè¿è¡Œå®Œæˆåï¼Œä¼šåœ¨é¡¹ç›®æ ¹ç›®å½•è‡ªåŠ¨ç”Ÿæˆ `result.jsonl` æ–‡ä»¶

#### **æ­¥éª¤ 5ï¼šå‡†å¤‡æäº¤æ–‡ä»¶**
å°†ç”Ÿæˆçš„ç»“æœæ–‡ä»¶ç§»åŠ¨åˆ°æäº¤ç›®å½•ï¼š
```bash
cp result.jsonl submission/result.jsonl
```

#### **æ­¥éª¤ 6ï¼šæ‰§è¡Œç»“æœæäº¤**
åˆ‡æ¢åˆ°æäº¤ç›®å½•å¹¶è¿è¡Œæäº¤è„šæœ¬ï¼š
```bash
cd submission
python submit.py
```

**âœ… æäº¤æˆåŠŸç¤ºä¾‹**ï¼š
```
Success! Your submission ID is 1757931486600
```
> ğŸ“ è¯·è®°å½•è¿™ä¸ªsubmission IDï¼Œç”¨äºåç»­æŸ¥è¯¢è¯„åˆ†ç»“æœ

#### **æ­¥éª¤ 7ï¼šæŸ¥è¯¢è¯„æµ‹æˆç»©**
ä½¿ç”¨è·å¾—çš„submission IDæŸ¥è¯¢è¯„åˆ†ï¼š
```bash
python submit.py -i 1757931486600
```

**ğŸ“Š è¯„åˆ†ç»“æœç¤ºä¾‹**ï¼š
```
Submission 1757931486600 score: 0.3275
```
> ğŸ¯ åˆ†æ•°è¶Šæ¥è¿‘1.0è¡¨ç¤ºé¢„æµ‹å‡†ç¡®æ€§è¶Šé«˜

## å¯èƒ½é‡åˆ°çš„é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ

### 1. Dockerç›¸å…³é—®é¢˜

**é—®é¢˜**: DockeræœåŠ¡æœªè¿è¡Œ
```
é”™è¯¯: Docker æœåŠ¡æœªè¿è¡Œæˆ–æƒé™ä¸è¶³
```

**è§£å†³æ–¹æ¡ˆ**:
```bash
# å¯åŠ¨DockeræœåŠ¡
sudo systemctl start docker

# å°†ç”¨æˆ·æ·»åŠ åˆ°dockerç»„
sudo usermod -aG docker $USER
# é‡æ–°ç™»å½•æˆ–æ‰§è¡Œ
newgrp docker
```

**é—®é¢˜**: Dockeré•œåƒæ„å»ºå¤±è´¥
```
é”™è¯¯: Docker é•œåƒæ„å»ºå¤±è´¥
```

**è§£å†³æ–¹æ¡ˆ**:

1. é…ç½®åŠ é€Ÿå™¨

```bash
sudo tee /etc/docker/daemon.json <<-'EOF'
{
  "registry-mirrors": [
    "https://docker.m.daocloud.io",
    "https://dockerproxy.com",
    "https://docker.mirrors.ustc.edu.cn",
    "https://docker.nju.edu.cn",
    "https://vp5v3vra.mirror.aliyuncs.com",
    "https://docker.registry.cyou",
    "https://docker-cf.registry.cyou",
    "https://dockercf.jsdelivr.fyi",
    "https://docker.jsdelivr.fyi",
    "https://dockertest.jsdelivr.fyi",
    "https://mirror.baidubce.com",
    "https://docker.m.daocloud.io",
    "https://docker.nju.edu.cn",
    "https://docker.mirrors.sjtug.sjtu.edu.cn",
    "https://docker.mirrors.ustc.edu.cn",
    "https://mirror.iscas.ac.cn",
    "https://docker.rainbond.cc"
  ]
}
EOF
```

2. é‡å¯ Docker æœåŠ¡

```bash
sudo systemctl daemon-reload
sudo systemctl restart docker

```

### 2. ç½‘ç»œè¿æ¥é—®é¢˜

**é—®é¢˜**: LLM APIè®¿é—®å¤±è´¥

**è§£å†³æ–¹æ¡ˆ**:
- æ£€æŸ¥ src/.env æ–‡ä»¶ä¸­ç¯å¢ƒå˜é‡ `KEJIYUN_API_KEY` å’Œ `KEJIYUN_API_BASE` æ˜¯å¦æ­£ç¡®é…ç½®ï¼ˆé»˜è®¤ä½¿ç”¨çš„é˜Ÿä¼ apiï¼‰

### 3. å†…å­˜ä¸è¶³é—®é¢˜

**é—®é¢˜**: å®¹å™¨è¿è¡Œæ—¶å†…å­˜ä¸è¶³å¯¼è‡´ç¨‹åºå´©æºƒï¼Œæœºå™¨å¡æ­»

**è§£å†³æ–¹æ¡ˆ**:
- å»ºè®®å¯ä»¥æ‰‹åŠ¨ä¿®æ”¹å¤šè¿›ç¨‹æ•°é‡ï¼Œåœ¨src/main_multiprocessing.pyä¸­è°ƒæ•´è¿›ç¨‹æ± å¤§å°ï¼ˆé»˜è®¤ä½¿ç”¨50%çš„æ ¸å¿ƒæ•°ï¼‰ï¼Œä½†æ˜¯å¦‚æœå†…å­˜å¤ªå°å¯èƒ½å¯¼è‡´çˆ†æ»¡å¯¼è‡´æœºå™¨å¡æ­»ï¼Œè¯·å…³æ³¨å†…å­˜ä½¿ç”¨æƒ…å†µï¼Œå¦‚æœçˆ†æ»¡ï¼Œè¯·å°†å…¶ä¿®æ”¹è‡³åˆé€‚çš„æ¯”ä¾‹:
```python
num_processes = max(1, int(cpu_count() * 0.5))
```

## æ³¨æ„äº‹é¡¹

1. ç¡®ä¿æ‰€æœ‰ä¾èµ–çš„å¤–éƒ¨æœåŠ¡ï¼ˆLLM APIï¼‰å¯æ­£å¸¸è®¿é—®
2. å»ºè®®åœ¨æ€§èƒ½è¾ƒå¥½çš„æœºå™¨ä¸Šè¿è¡Œï¼Œå¤„ç†å¤§é‡æ•°æ®æ—¶å¯èƒ½éœ€è¦è¾ƒé•¿æ—¶é—´

## è‡´è°¢

æ„Ÿè°¢CCF AIOps 2025æŒ‘æˆ˜èµ›ç»„å§”ä¼šæä¾›çš„é«˜è´¨é‡æ•°æ®é›†å’Œè‰¯å¥½çš„ç«èµ›ç¯å¢ƒï¼Œä¸ºæˆ‘ä»¬å›¢é˜Ÿæä¾›äº†å®è´µçš„å­¦ä¹ å’Œäº¤æµå¹³å°ã€‚

æœ¬é¡¹ç›®å‚ä¸çš„æ¯”èµ›ä¸ºï¼š**èµ›é“ä¸€: åŸºäºå¤§æ¨¡å‹æ™ºèƒ½ä½“çš„å¾®æœåŠ¡æ ¹å› å®šä½**  
æ¯”èµ›å®˜ç½‘ï¼š[CCF AIOps 2025 Challenge](https://challenge.aiops.cn/home/competition/1920410697896845344)

## Star History

![Star History Chart](https://api.star-history.com/svg?repos=tangpan360/MicroRCA-Agent&type=Date)